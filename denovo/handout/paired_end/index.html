



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="This contains all material for the Introduction to NGS workshop.">
      
      
      
        <meta name="author" content="Sonika Tyagi">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.2">
    
    
      
        <title>Paired end - Introduction to NGS Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/details.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#assembling-paired-end-reads" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Introduction to NGS Workshop" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Introduction to NGS Workshop
            </span>
            <span class="md-header-nav__topic">
              
                Paired end
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Introduction to NGS Workshop" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Introduction to NGS Workshop
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../trainers/trainers/" title="The Trainers" class="md-nav__link">
      The Trainers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../preamble/preamble/" title="Workshop Information" class="md-nav__link">
      Workshop Information
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Hands-on Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Hands-on Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../login/login/" title="Loging to the training VM" class="md-nav__link">
      Loging to the training VM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../R/Rhandout/" title="Introduction to R" class="md-nav__link">
      Introduction to R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../cli/handout/handout/" title="Introduction to Command Line" class="md-nav__link">
      Introduction to Command Line
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../qc/handout/handout/" title="Quality Control" class="md-nav__link">
      Quality Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../alignment/handout/handout/" title="Read Alignment" class="md-nav__link">
      Read Alignment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rna_seq/handout/handout/" title="RNA-Seq" class="md-nav__link">
      RNA-Seq
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../handout/" title="De Novo Genome Assembly" class="md-nav__link">
      De Novo Genome Assembly
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../denovo-canu/handout/handout/" title="De Novo Canu" class="md-nav__link">
      De Novo Canu
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#amos-hawkeye" class="md-nav__link">
    AMOS Hawkeye
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#velvet-and-data-quality" class="md-nav__link">
    Velvet and Data Quality
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="assembling-paired-end-reads">Assembling Paired-end Reads</h1>
<p>The use of paired-end data in <em>de novo</em> genome assembly results in
better quality assemblies, particularly for larger, more complex
genomes. In addition, paired-end constraint violation (expected distance
and orientation of paired reads) can be used to identify misassemblies.</p>
<p>If you are doing <em>de novo</em> assembly, pay the extra and get paired-ends:
they’re worth it!</p>
<p>The data you will examine in this exercise is again from Staphylococcus
aureus which has a genome of around 3MBases. The reads are Illumina
paired end with an insert size of $~$350 bp.</p>
<p>The required data can be downloaded from the SRA. Specifically, the run
data (SRR022852) from the SRA Sample SRS004748.</p>
<p>The following exercise focuses on preparing the paired-end FASTQ files
ready for Velvet, using Velvet in paired-end mode and comparing results
with Velvet’s ’auto’ option.</p>
<p>First move to the directory you made for this exercise and make a
suitable named directory for the exercise:</p>
<div class="codehilite"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">trainee</span><span class="o">/</span><span class="n">denovo</span><span class="o">/</span><span class="n">NGS</span><span class="o">/</span><span class="n">velvet</span><span class="o">/</span><span class="n">part2</span> 
<span class="n">mkdir</span> <span class="n">SRS004748</span> 
<span class="n">cd</span> <span class="n">SRS004748</span>
</pre></div>


<p>There is no need to download the read files, as they are already stored
locally. You will simply create a symlink to this pre-downloaded data
using the following commands:</p>
<div class="codehilite"><pre><span></span><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">trainee</span><span class="o">/</span><span class="n">denovo</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">SRR022852_</span><span class="o">?</span><span class="p">.</span><span class="n">fastq</span><span class="p">.</span><span class="n">gz</span> <span class="p">.</span><span class="o">/</span>
</pre></div>


<p>It is interesting to monitor the computer’s resource utilisation,
particularly memory. A simple way to do this is to open a second
terminal and in it type:</p>
<div class="codehilite"><pre><span></span><span class="n">top</span>
</pre></div>


<p><code class="codehilite"><span class="n">top</span></code> is a program that continually monitors all the processes running
on your computer, showing the resources used by each. Leave this running
and refer to it periodically throughout your Velvet analyses.
Particularly if they are taking a long time or whenever your curiosity
gets the better of you. You should find that as this practical
progresses, memory usage will increase significantly.</p>
<p>Now, back to the first terminal, you are ready to run <code class="codehilite"><span class="n">velveth</span></code> and
<code class="codehilite"><span class="n">velvetg</span></code>. The reads are <code class="codehilite"><span class="o">-</span><span class="n">shortPaired</span></code> and for the first run you should
not use any parameters for <code class="codehilite"><span class="n">velvetg</span></code>.</p>
<p>From this point on, where it will be informative to time your runs. This
is very easy to do, just prefix the command to run the program with the
command <code class="codehilite"><span class="n">time</span></code>. This will cause UNIX to report how long the program took
to complete its task.</p>
<p>Set the two stages of velvet running, whilst you watch the memory usage
as reported by <code class="codehilite"><span class="n">top</span></code>. Time the <code class="codehilite"><span class="n">velvetg</span></code> stage:</p>
<div class="codehilite"><pre><span></span><span class="n">velveth</span> <span class="n">run_25</span> <span class="mi">25</span> <span class="o">-</span><span class="n">fmtAuto</span> <span class="o">-</span><span class="n">create_binary</span> <span class="o">-</span><span class="n">shortPaired</span> <span class="o">-</span><span class="n">separate</span> <span class="n">SRR022852_1</span><span class="p">.</span><span class="n">fastq</span><span class="p">.</span><span class="n">gz</span> <span class="n">SRR022852_2</span><span class="p">.</span><span class="n">fastq</span><span class="p">.</span><span class="n">gz</span>
<span class="n">time</span> <span class="n">velvetg</span> <span class="n">run_25</span>
</pre></div>


<p>What does <code class="codehilite"><span class="o">-</span><span class="n">fmtAuto</span></code> and <code class="codehilite"><span class="o">-</span><span class="n">create_binary</span></code> do? (see help menu)</p>
<p><code class="codehilite"><span class="o">-</span><span class="n">fmtAuto</span></code> tries to detect the correct format of the input files e.g.
FASTA, FASTQ and whether they are compressed or not.</p>
<p><code class="codehilite"><span class="o">-</span><span class="n">create_binary</span></code> outputs sequences as a binary file. That means that
<code class="codehilite"><span class="n">velvetg</span></code> can read the sequences from the binary file more quickly that
from the original sequence files.</p>
<p>Comment on the use of memory and CPU for <code class="codehilite"><span class="n">velveth</span></code> and <code class="codehilite"><span class="n">velvetg</span></code>?</p>
<p><code class="codehilite"><span class="n">velveth</span></code> uses only one CPU while <code class="codehilite"><span class="n">velvetg</span></code> uses all possible CPUs for
some parts of the calculation.</p>
<p>How long did <code class="codehilite"><span class="n">velvetg</span></code> take?</p>
<p>My own measurements are:\
<code class="codehilite"><span class="nb">real</span> <span class="mi">1</span><span class="n">m8</span><span class="p">.</span><span class="mi">877</span><span class="n">s</span><span class="p">;</span> <span class="k">user</span> <span class="mi">4</span><span class="n">m15</span><span class="p">.</span><span class="mi">324</span><span class="n">s</span><span class="p">;</span> <span class="n">sys</span> <span class="mi">0</span><span class="n">m4</span><span class="p">.</span><span class="mi">716</span><span class="n">s</span></code></p>
<p>Next, after saving your <code class="codehilite"><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span></code> file from being overwritten, set
the cut-off parameters that you investigated in the previous exercise
and rerun <code class="codehilite"><span class="n">velvetg</span></code>. time and monitor the use of resources as
previously. Start with <code class="codehilite"><span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">16</span></code> thus:</p>
<div class="codehilite"><pre><span></span><span class="n">mv</span> <span class="n">run_25</span><span class="o">/</span><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span> <span class="n">run_25</span><span class="o">/</span><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span><span class="p">.</span><span class="mi">0</span>
<span class="n">time</span> <span class="n">velvetg</span> <span class="n">run_25</span> <span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">16</span>
</pre></div>


<p>Up until now, <code class="codehilite"><span class="n">velvetg</span></code> has ignored the paired-end information. Now try
running <code class="codehilite"><span class="n">velvetg</span></code> with both <code class="codehilite"><span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">16</span></code> and <code class="codehilite"><span class="o">-</span><span class="n">exp_cov</span> <span class="mi">26</span></code>, but
first save your <code class="codehilite"><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span></code> file. By using <code class="codehilite"><span class="o">-</span><span class="n">cov_cutoff</span></code> and
<code class="codehilite"><span class="o">-</span><span class="n">exp_cov</span></code>, <code class="codehilite"><span class="n">velvetg</span></code> tries to estimate the insert length, which you
will see in the <code class="codehilite"><span class="n">velvetg</span></code> output. The command is, of course:</p>
<div class="codehilite"><pre><span></span><span class="n">mv</span> <span class="n">run_25</span><span class="o">/</span><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span> <span class="n">run_25</span><span class="o">/</span><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span><span class="p">.</span><span class="mi">1</span>
<span class="n">time</span> <span class="n">velvetg</span> <span class="n">run_25</span> <span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">16</span> <span class="o">-</span><span class="n">exp_cov</span> <span class="mi">26</span>
</pre></div>


<p>Comment on the time required, use of memory and CPU for <code class="codehilite"><span class="n">velvetg</span></code>?</p>
<p>Runtime is lower when velvet can reuse previously calculated data. By
using <code class="codehilite"><span class="o">-</span><span class="n">exp_cov</span></code>, the memory usage increases.</p>
<p>Which insert length does Velvet estimate?</p>
<p>Paired-end library 1 has length: 228, sample standard deviation: 26</p>
<p>Next try running <code class="codehilite"><span class="n">velvetg</span></code> in ‘paired-end mode‘. This entails running
<code class="codehilite"><span class="n">velvetg</span></code> specifying the insert length with the parameter <code class="codehilite"><span class="o">-</span><span class="n">ins_length</span></code>
set to 350. Even though velvet estimates the insert length it is always
advisable to check / provide the insert length manually as velvet can
get the statistics wrong due to noise. Just in case, save your last
version of <code class="codehilite"><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span></code>. The commands are:</p>
<div class="codehilite"><pre><span></span><span class="n">mv</span> <span class="n">run_25</span><span class="o">/</span><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span> <span class="n">run_25</span><span class="o">/</span><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span><span class="p">.</span><span class="mi">2</span>
<span class="n">time</span> <span class="n">velvetg</span> <span class="n">run_25</span> <span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">16</span> <span class="o">-</span><span class="n">exp_cov</span> <span class="mi">26</span> <span class="o">-</span><span class="n">ins_length</span> <span class="mi">350</span>
<span class="n">mv</span> <span class="n">run_25</span><span class="o">/</span><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span> <span class="n">run_25</span><span class="o">/</span><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span><span class="p">.</span><span class="mi">3</span>
</pre></div>


<p>How fast was this run?</p>
<p>My own measurements are:\
<code class="codehilite"><span class="nb">real</span> <span class="mi">0</span><span class="n">m29</span><span class="p">.</span><span class="mi">792</span><span class="n">s</span><span class="p">;</span> <span class="k">user</span> <span class="mi">1</span><span class="n">m4</span><span class="p">.</span><span class="mi">372</span><span class="n">s</span><span class="p">;</span> <span class="n">sys</span> <span class="mi">0</span><span class="n">m3</span><span class="p">.</span><span class="mi">880</span><span class="n">s</span></code></p>
<p>Take a look into the Log file.</p>
<p>What is the N50 value for the <code class="codehilite"><span class="n">velvetg</span></code> runs using the switches:\</p>
<p>Base run: 19,510 bp</p>
<p><code class="codehilite"><span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">16</span></code></p>
<p>24,739 bp</p>
<p><code class="codehilite"><span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">16</span> <span class="o">-</span><span class="n">exp_cov</span> <span class="mi">26</span></code></p>
<p>61,793 bp</p>
<p><code class="codehilite"><span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">16</span> <span class="o">-</span><span class="n">exp_cov</span> <span class="mi">26</span> <span class="o">-</span><span class="n">ins_length</span> <span class="mi">350</span></code></p>
<p>n50 of 62,740 bp; max 194,649 bp; total 2,871,093 bp</p>
<p>Try giving the <code class="codehilite"><span class="o">-</span><span class="n">cov_cutoff</span></code> and/or <code class="codehilite"><span class="o">-</span><span class="n">exp_cov</span></code> parameters the value
<code class="codehilite"><span class="n">auto</span></code>. See the <code class="codehilite"><span class="n">velvetg</span></code> help to show you how. The information Velvet
prints during running includes information about the values used
(coverage cut-off or insert length) when using the <code class="codehilite"><span class="n">auto</span></code> option.</p>
<p>What coverage values does Velvet choose (hint: look at the output that
Velvet produces while running)?</p>
<p>Median coverage depth = 26.021837\
Removing contigs with coverage $&lt;$ 13.010918 …</p>
<p>How does the N50 value change?</p>
<p>n50 of 68,843 bp; max 194,645 bp; total 2,872,678 bp</p>
<p>Run <code class="codehilite"><span class="n">gnx</span></code> on all the <code class="codehilite"><span class="n">contig</span><span class="p">.</span><span class="n">fa</span></code> files you have generated in the course
of this exercise. The command will be:</p>
<div class="codehilite"><pre><span></span><span class="n">gnx</span> <span class="o">-</span><span class="k">min</span> <span class="mi">100</span> <span class="o">-</span><span class="n">nx</span> <span class="mi">25</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">75</span> <span class="n">run_25</span><span class="o">/</span><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span><span class="o">*</span>
</pre></div>


<p>For which runs are there Ns in the <code class="codehilite"><span class="n">contigs</span><span class="p">.</span><span class="n">fa</span></code> file and why?</p>
<p>contigs.fa.2, contigs.fa.3, contigs.fa\
Velvet tries to use the provided (or infers) the insert length and fills
ambiguous regions with Ns.</p>
<p>Comment on the number of contigs and total length generated for each
run.</p>
<p>Filename       No. contigs   Total length   No. Ns</p>
<hr />
<p>Contigs.fa.0   631           2,830,659      0
  Contigs.fa.1   580           2,832,670      0
  Contigs.fa.2   166           2,849,919      4,847
  Contigs.fa.3   166           2,856,795      11,713
  Contigs.fa     163           2,857,439      11,526</p>
<p>: <script type="math/tex; mode=display">tab:velvetrunresults</script>
</p>
<h2 id="amos-hawkeye">AMOS Hawkeye</h2>
<p>We will now output the assembly in the AMOS massage format and visualise
the assembly using AMOS Hawkeye.</p>
<p>Run <code class="codehilite"><span class="n">velvetg</span></code> with appropriate arguments and output the AMOS message
file, then convert it to an AMOS bank and open it in Hawkeye:</p>
<div class="codehilite"><pre><span></span><span class="n">time</span> <span class="n">velvetg</span> <span class="n">run_25</span> <span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">16</span> <span class="o">-</span><span class="n">exp_cov</span> <span class="mi">26</span> <span class="o">-</span><span class="n">ins_length</span> <span class="mi">350</span> <span class="o">-</span><span class="n">amos_file</span> <span class="n">yes</span> <span class="o">-</span><span class="n">read_trkg</span> <span class="n">yes</span> 
<span class="n">time</span> <span class="n">bank</span><span class="o">-</span><span class="n">transact</span> <span class="o">-</span><span class="k">c</span> <span class="o">-</span><span class="n">b</span> <span class="n">run_25</span><span class="o">/</span><span class="n">velvet_asm</span><span class="p">.</span><span class="n">bnk</span> <span class="o">-</span><span class="n">m</span> <span class="n">run_25</span><span class="o">/</span><span class="n">velvet_asm</span><span class="p">.</span><span class="n">afg</span>         
<span class="n">hawkeye</span> <span class="n">run_25</span><span class="o">/</span><span class="n">velvet_asm</span><span class="p">.</span><span class="n">bnk</span>
</pre></div>


<p>Looking at the scaffold view of a contig, comment on the proportion of
“happy mates” to “compressed mates” and “stretched mates”.</p>
<p>Nearly all mates are compressed with no stretched mates and very few
happy mates.</p>
<p>What is the mean and standard deviation of the insert size reported
under the Libraries tab?</p>
<p>Mean: 350 bp SD: 35 bp</p>
<p>Look at the actual distribution of insert sizes for this library. Can
you explain where there is a difference between the mean and SD reported
in those two places?</p>
<p>We specified <code class="codehilite"><span class="o">-</span><span class="n">ins_length</span> <span class="mi">350</span></code> to the <code class="codehilite"><span class="n">velvetg</span></code> command. Velvet uses
this value, in the AMOS message file that it outputs, rather than its
own estimate.</p>
<p>You can get AMOS to re-estimate the mean and SD of insert sizes using
intra-contig pairs. First, close Hawkeye and then run the following
commands before reopening the AMOS bank to see what has changed.</p>
<div class="codehilite"><pre><span></span><span class="n">asmQC</span> <span class="o">-</span><span class="n">b</span> <span class="n">run_25</span><span class="o">/</span><span class="n">velvet_asm</span><span class="p">.</span><span class="n">bnk</span> <span class="o">-</span><span class="n">scaff</span> <span class="o">-</span><span class="n">recompute</span> <span class="o">-</span><span class="k">update</span> <span class="o">-</span><span class="n">numsd</span> <span class="mi">2</span>
<span class="n">hawkeye</span> <span class="n">run_25</span><span class="o">/</span><span class="n">velvet_asm</span><span class="p">.</span><span class="n">bnk</span>
</pre></div>


<p>Looking at the scaffold view of a contig, comment on the proportion of
“happy mates” to “compressed mates” and “stretched mates”.</p>
<p>There are only a few compressed and stretched mates compared to happy
mates. There are similar numbers of stretched and compressed mates.</p>
<p>What is the mean and standard deviation of the insert size reported
under the Libraries tab?</p>
<p>TODO Mean: 226 bp SD: 25 bp</p>
<p>Look at the actual distribution of insert sizes for this library. Does
the mean and SD reported in both places now match?</p>
<p>Yes</p>
<p>Can you find a region with an unusually high proportion of stretched,
compressed, incorrectly orientated or linking mates? What might this
situation indicate?</p>
<p>This would indicate a possible misassembly and worthy of further
investigation.</p>
<p>Look at the largest scaffold, there are stacks of stretched pairs which
span contig boundaries. This indicates that the gap size has been
underestimated during the scaffolding phase.</p>
<h2 id="velvet-and-data-quality">Velvet and Data Quality</h2>
<p>So far we have used the raw read data without performing any quality
control or read trimming prior to doing our velvet assemblies.</p>
<p>Velvet does not use quality information present in FASTQ files.</p>
<p>For this reason, it is vitally important to perform read QC and quality
trimming. In doing so, we remove errors/noise from the dataset which in
turn means velvet will run faster, will use less memory and will produce
a better assembly. Assuming we haven’t compromised too much on coverage.</p>
<p>To investigate the effect of data quality, we will use the run data
(SRR023408) from the SRA experiment SRX008042. The reads are Illumina
paired end with an insert size of 92 bp.</p>
<p>Go back to the main directory for this exercise and create and enter a
new directory dedicated to this phase of the exercise. The commands are:</p>
<div class="codehilite"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">trainee</span><span class="o">/</span><span class="n">denovo</span><span class="o">/</span><span class="n">NGS</span><span class="o">/</span><span class="n">velvet</span><span class="o">/</span><span class="n">part2</span> 
<span class="n">mkdir</span> <span class="n">SRX008042</span> 
<span class="n">cd</span> <span class="n">SRX008042</span>
</pre></div>


<p>Create symlinks to the read data files that we downloaded for you from
the SRA:</p>
<div class="codehilite"><pre><span></span><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">trainee</span><span class="o">/</span><span class="n">denovo</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">SRR023408_</span><span class="o">?</span><span class="p">.</span><span class="n">fastq</span><span class="p">.</span><span class="n">gz</span> <span class="p">.</span><span class="o">/</span>
</pre></div>


<p>We will use FastQC, a tool you should be familiar with, to visualise the
quality of our data. We will use FastQC in the Graphical User Interface
(GUI) mode.</p>
<p>Start FastQC and set the process running in the background, by using a
trailing <code class="codehilite"><span class="o">&amp;</span></code>, so we get control of our terminal back for entering more
commands:</p>
<div class="codehilite"><pre><span></span><span class="n">fastqc</span> <span class="o">&amp;</span>
</pre></div>


<p>Open the two compressed FASTQ files (File $-&gt;$ Open) by selecting them
both and clicking OK). Look at tabs for both files:</p>
<p><img alt="fig:paired\_fastqc" src="../images/paired_fastqc.png" />{width=&rdquo;80.00000%&rdquo;}</p>
<p>Are the quality scores the same for both files?</p>
<p>Overall yes</p>
<p>Which value varies?</p>
<p>Per sequence quality scores</p>
<p>Take a look at the Per base sequence quality for both files. Did you
note that it is not good for either file?</p>
<p>The quality score of both files drop very fast. Qualities of the REV
strand drop faster than the FWD strand. This is because the template has
been sat around while the FWD strand was sequenced.</p>
<p>At which positions would you cut the reads if we did “fixed length
trimming”?</p>
<p>Looking at the “Per base quality&rdquo; and “Per base sequence content”, I
would choose around 27</p>
<p>Why does the quality deteriorate towards the end of the read?</p>
<p>Errors more likely for later cycles</p>
<p>Does it make sense to trim the 5’ start of reads?</p>
<p>Looking at the “Per base sequence content&rdquo;, yes - there is a clear
signal at the beginning.</p>
<p>Have a look at the other options that FastQC offers.</p>
<p>Which other statistics could you use to support your trimming strategy?</p>
<p>“Per base sequence content&rdquo;, “Per base GC content&rdquo;, “Kmer content&rdquo;, “Per
base sequence quality&rdquo;</p>
<p><img alt="fig:paired\_fastqc\_quality\_plots" src="../images/paired_fastqc_quality_plots.png" />{width=&rdquo;80.00000%&rdquo;}</p>
<p>Once you have decided what your trim points will be, close FastQC. We
will use <code class="codehilite"><span class="n">fastx_trimmer</span></code> from the FASTX-Toolkit to perform fixed-length
trimming. For usage information see the help:</p>
<div class="codehilite"><pre><span></span><span class="n">fastx_trimmer</span> <span class="o">-</span><span class="n">h</span>
</pre></div>


<p><code class="codehilite"><span class="n">fastx_trimmer</span></code> is not able to read compressed FASTQ files, so we first
need to decompress the files ready for input.</p>
<p>The suggestion (hopefully not far from your own thoughts?) is that you
trim your reads as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">gunzip</span> <span class="o">&lt;</span> <span class="n">SRR023408_1</span><span class="p">.</span><span class="n">fastq</span><span class="p">.</span><span class="n">gz</span> <span class="o">&gt;</span> <span class="n">SRR023408_1</span><span class="p">.</span><span class="n">fastq</span>
<span class="n">gunzip</span> <span class="o">&lt;</span> <span class="n">SRR023408_2</span><span class="p">.</span><span class="n">fastq</span><span class="p">.</span><span class="n">gz</span> <span class="o">&gt;</span> <span class="n">SRR023408_2</span><span class="p">.</span><span class="n">fastq</span>
<span class="n">fastx_trimmer</span> <span class="o">-</span><span class="n">Q</span> <span class="mi">33</span> <span class="o">-</span><span class="n">f</span> <span class="mi">1</span> <span class="o">-</span><span class="n">l</span> <span class="mi">32</span> <span class="o">-</span><span class="n">i</span> <span class="n">SRR023408_1</span><span class="p">.</span><span class="n">fastq</span> <span class="o">-</span><span class="n">o</span> <span class="n">SRR023408_trim1</span><span class="p">.</span><span class="n">fastq</span> 
<span class="n">fastx_trimmer</span> <span class="o">-</span><span class="n">Q</span> <span class="mi">33</span> <span class="o">-</span><span class="n">f</span> <span class="mi">1</span> <span class="o">-</span><span class="n">l</span> <span class="mi">27</span> <span class="o">-</span><span class="n">i</span> <span class="n">SRR023408_2</span><span class="p">.</span><span class="n">fastq</span> <span class="o">-</span><span class="n">o</span> <span class="n">SRR023408_trim2</span><span class="p">.</span><span class="n">fastq</span>
</pre></div>


<p>Many NGS read files are large. This means that simply reading and
writing files can become the bottleneck, also known as I/O bound.
Therefore, it is often good practice to avoid unnecessary disk
read/write.</p>
<p>We could do what is called pipelining to send a stream of data from one
command to another, using the pipe (<code class="codehilite"><span class="o">|</span></code>) character, without the need for
intermediary files. The following command would achieve this:</p>
<div class="codehilite"><pre><span></span><span class="n">gunzip</span> <span class="c1">--to-stdout &lt; SRR023408_1.fastq.gz | fastx_trimmer -Q 33 -f 4 -l 32 -o SRR023408_trim1.fastq </span>
<span class="n">gunzip</span> <span class="c1">--to-stdout &lt; SRR023408_2.fastq.gz | fastx_trimmer -Q 33 -f 3 -l 29 -o SRR023408_trim2.fastq</span>
</pre></div>


<p>Now run <code class="codehilite"><span class="n">velveth</span></code> with a k-mer value of 21 for both the untrimmed and
trimmed read files in <code class="codehilite"><span class="o">-</span><span class="n">shortPaired</span></code> mode. Separate the output of the
two executions of <code class="codehilite"><span class="n">velveth</span></code> into suitably named directories, followed by
<code class="codehilite"><span class="n">velvetg</span></code>:</p>
<div class="codehilite"><pre><span></span><span class="o">#</span> <span class="n">untrimmed</span> <span class="k">reads</span>
<span class="n">velveth</span> <span class="n">run_21</span> <span class="mi">21</span> <span class="o">-</span><span class="n">fmtAuto</span> <span class="o">-</span><span class="n">create_binary</span> <span class="o">-</span><span class="n">shortPaired</span> <span class="o">-</span><span class="n">separate</span> <span class="n">SRR023408_1</span><span class="p">.</span><span class="n">fastq</span> <span class="n">SRR023408_2</span><span class="p">.</span><span class="n">fastq</span>
<span class="n">time</span> <span class="n">velvetg</span> <span class="n">run_21</span>

<span class="o">#</span> <span class="n">trimmed</span> <span class="k">reads</span>
<span class="n">velveth</span> <span class="n">run_21trim</span> <span class="mi">21</span> <span class="o">-</span><span class="n">fmtAuto</span> <span class="o">-</span><span class="n">create_binary</span> <span class="o">-</span><span class="n">shortPaired</span> <span class="o">-</span><span class="n">separate</span> <span class="n">SRR023408_trim1</span><span class="p">.</span><span class="n">fastq</span> <span class="n">SRR023408_trim2</span><span class="p">.</span><span class="n">fastq</span>
<span class="n">time</span> <span class="n">velvetg</span> <span class="n">run_21trim</span>
</pre></div>


<p>How long did the two <code class="codehilite"><span class="n">velvetg</span></code> runs take?</p>
<p>run_25: <code class="codehilite"><span class="nb">real</span> <span class="mi">3</span><span class="n">m16</span><span class="p">.</span><span class="mi">132</span><span class="n">s</span><span class="p">;</span> <span class="k">user</span> <span class="mi">8</span><span class="n">m18</span><span class="p">.</span><span class="mi">261</span><span class="n">s</span><span class="p">;</span> <span class="n">sys</span> <span class="mi">0</span><span class="n">m7</span><span class="p">.</span><span class="mi">317</span><span class="n">s</span></code>\
run_25trim: <code class="codehilite"><span class="nb">real</span> <span class="mi">1</span><span class="n">m18</span><span class="p">.</span><span class="mi">611</span><span class="n">s</span><span class="p">;</span> <span class="k">user</span> <span class="mi">3</span><span class="n">m53</span><span class="p">.</span><span class="mi">140</span><span class="n">s</span><span class="p">;</span> <span class="n">sys</span> <span class="mi">0</span><span class="n">m4</span><span class="p">.</span><span class="mi">962</span><span class="n">s</span></code></p>
<p>What N50 scores did you achieve?</p>
<p>Untrimmed: 11\
Trimmed: 15</p>
<p>What were the overall effects of trimming?</p>
<p>Time saving, increased N50, reduced coverage</p>
<p>The evidence is that trimming improved the assembly. The thing to do
surely, is to run <code class="codehilite"><span class="n">velvetg</span></code> with the <code class="codehilite"><span class="o">-</span><span class="n">cov_cutoff</span></code> and <code class="codehilite"><span class="o">-</span><span class="n">exp_cov</span></code>. In
order to use <code class="codehilite"><span class="o">-</span><span class="n">cov_cutoff</span></code> and <code class="codehilite"><span class="o">-</span><span class="n">exp_cov</span></code> sensibly, you need to
investigate with R, as you did in the previous exercise, what parameter
values to use. Start up R and produce the weighted histograms:</p>
<p>``` {style=&rdquo;R&rdquo;}
R &ndash;no-save
library(plotrix) 
data &lt;- read.table(&ldquo;run_21/stats.txt&rdquo;, header=TRUE) 
data2 &lt;- read.table(&ldquo;run_21trim/stats.txt&rdquo;, header=TRUE) 
par(mfrow=c(1,2))
weighted.hist(data$short1_cov, data$lgth, breaks=0:50)
weighted.hist(data2$short1_cov, data2$lgth, breaks=0:50)
<div class="codehilite"><pre><span></span><span class="o">!</span>[\[<span class="nv">fig</span>:<span class="nv">velvet</span>\<span class="nv">_Rplot002</span>\] <span class="nv">Weighted</span> <span class="nv">k</span><span class="o">-</span><span class="nv">mer</span> <span class="nv">coverage</span> <span class="nv">histograms</span> <span class="nv">of</span> <span class="nv">the</span>
<span class="nv">paired</span><span class="o">-</span><span class="k">end</span> <span class="nv">reads</span> <span class="nv">pre</span><span class="o">-</span><span class="nv">trimmed</span> <span class="ss">(</span><span class="nv">left</span><span class="ss">)</span> <span class="nv">and</span> <span class="nv">post</span><span class="o">-</span><span class="nv">trimmed</span>
<span class="ss">(</span><span class="nv">right</span><span class="ss">)</span>.]<span class="ss">(</span><span class="nv">handout</span><span class="o">/</span><span class="nv">velvet</span><span class="o">/</span><span class="nv">velvet_Rplot002</span>.<span class="nv">png</span><span class="ss">)</span>{<span class="nv">width</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">80.00000%</span><span class="s2">&quot;</span>}

<span class="k">For</span> <span class="nv">the</span> <span class="nv">untrimmed</span> <span class="nv">read</span> <span class="nv">histogram</span> <span class="ss">(</span><span class="nv">left</span><span class="ss">)</span> <span class="nv">there</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">expected</span> <span class="nv">coverage</span> <span class="nv">of</span>
<span class="nv">around</span> <span class="mi">13</span> <span class="nv">with</span> <span class="nv">a</span> <span class="nv">coverage</span> <span class="nv">cut</span><span class="o">-</span><span class="nv">off</span> <span class="nv">of</span> <span class="nv">around</span> <span class="mi">7</span>. <span class="k">For</span> <span class="nv">the</span> <span class="nv">trimmed</span> <span class="nv">read</span>
<span class="nv">histogram</span> <span class="ss">(</span><span class="nv">right</span><span class="ss">)</span> <span class="nv">there</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">expected</span> <span class="nv">coverage</span> <span class="nv">of</span> <span class="nv">around</span> <span class="mi">9</span> <span class="nv">with</span> <span class="nv">a</span>
<span class="nv">coverage</span> <span class="nv">cut</span><span class="o">-</span><span class="nv">off</span> <span class="nv">of</span> <span class="nv">around</span> <span class="mi">5</span>.

<span class="k">If</span> <span class="nv">you</span> <span class="nv">disagree</span>, <span class="nv">feel</span> <span class="nv">free</span> <span class="nv">to</span> <span class="nv">try</span> <span class="nv">different</span> <span class="nv">settings</span>, <span class="nv">but</span> <span class="nv">first</span> <span class="nv">quit</span> <span class="nv">R</span>
<span class="nv">before</span> <span class="nv">running</span> `<span class="nv">velvetg</span>`:

``` {<span class="nv">style</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">R</span><span class="s2">&quot;</span>}
<span class="nv">q</span><span class="ss">()</span>
</pre></div></p>
<div class="codehilite"><pre><span></span><span class="n">time</span> <span class="n">velvetg</span> <span class="n">run_21</span> <span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">7</span> <span class="o">-</span><span class="n">exp_cov</span> <span class="mi">13</span> <span class="o">-</span><span class="n">ins_length</span> <span class="mi">92</span>
<span class="n">time</span> <span class="n">velvetg</span> <span class="n">run_21trim</span> <span class="o">-</span><span class="n">cov_cutoff</span> <span class="mi">5</span> <span class="o">-</span><span class="n">exp_cov</span> <span class="mi">9</span> <span class="o">-</span><span class="n">ins_length</span> <span class="mi">92</span>
</pre></div>


<p>How good does it look now?\</p>
<p>Still not great</p>
<p>Comment on:\
Runtime</p>
<p>Reduced runtime</p>
<p>Memory</p>
<p>Lower memory usage</p>
<p>k-mer choice (Can you use k-mer 31 for a read of length 30 bp?)</p>
<p>K-mer has to be lower than the read length and the K-mer coverage should
be sufficient to produce results.</p>
<p>Does less data mean “worse&rdquo; results?</p>
<p>Not necessarily. If you have lots of data you can safely remove poor
data without too much impact on overall coverage.</p>
<p>How would a smaller/larger k-mer size behave?</p>
<p>Compare the results, produced during the last exercises, with each
other:</p>
<p>[0.9]{}[l|l|l|l]{} Metric &amp; SRR022852 &amp; SRR023408 &amp; SRR023408.trimmed\
Overall Quality (1-5) &amp; &amp; &amp;\
bp Coverage &amp; &amp; &amp;\
k-mer Coverage &amp; &amp; &amp;\
N50 (k-mer used) &amp; &amp; &amp;\</p>
<p>[0.9]{}[l|l|l|l]{} Metric &amp; SRR022852 &amp; SRR023408 &amp; SRR023408.trimmed\
Overall Quality (1-5) &amp; 2 &amp; 5 &amp; 4\
bp Coverage &amp; 136 x (36 bp;11,374,488) &amp; 95x (37bp; 7761796) &amp; 82x
(32bp; 7761796)\
k-mer Coverage &amp; 45x &amp; 43x (21); 33x (25) &amp; 30x (21); 20.5x (25)\
N50 (k-mer used) &amp; 68,843 (25) &amp; 2,803 (21) &amp; 2,914 (21)\</p>
<p>What would you consider as the “best&rdquo; assembly?</p>
<p>SRR022852</p>
<p>If you found a candidate, why do you consider it as “best&rdquo; assembly?</p>
<p>Overall data quality and coverage</p>
<p>How else might you assess the the quality of an assembly? Hint: Hawkeye.</p>
<p>By trying to identify paired-end constraint violations using AMOS
Hawkeye.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; The authors; 2019-
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c648116f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../../js/details.js"></script>
      
    
  </body>
</html>